<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dict√©e Interactive</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(270deg, #6a11cb, #2575fc, #6a11cb);
      background-size: 600% 600%;
      animation: gradientAnimation 15s ease infinite;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
    }

    @keyframes gradientAnimation {
      0% {background-position: 0% 50%;}
      50% {background-position: 100% 50%;}
      100% {background-position: 0% 50%;}
    }

    .container {
      background: rgba(255,255,255,0.1);
      padding: 30px;
      border-radius: 16px;
      max-width: 700px;
      width: 100%;
      text-align: center;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0,0,0,0.25);
    }

    h1 {
      margin-bottom: 20px;
      font-size: 1.8rem;
    }

    select, textarea, button {
      width: 100%;
      margin-top: 12px;
      padding: 12px;
      font-size: 1rem;
      border-radius: 8px;
      border: none;
      outline: none;
    }

    textarea {
      height: 180px;
      resize: vertical;
      background: rgba(255,255,255,0.9);
      color: #333;
    }

    select {
      background: rgba(255,255,255,0.9);
      color: #333;
    }

    .buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 15px;
    }

    .buttons button {
      flex: 1 1 calc(50% - 10px);
      background: #fff;
      color: #2575fc;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s;
    }

    .buttons button:hover {
      background: #2575fc;
      color: #fff;
    }

    #result {
      margin-top: 15px;
      font-weight: bold;
      min-height: 1.2em;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>üìú Dict√©e Interactive</h1>

    <select id="dictationSelect">
      <option value="laboureur">Le Laboureur et ses enfants</option>
      <option value="cigale">La Cigale et la Fourmi</option>
      <option value="lievre">Le Li√®vre et la Tortue</option>
      <option value="corbeau">Le Corbeau et le Renard</option>
      <option value="grenouille">La Grenouille et le B≈ìuf</option>
      <option value="fourmi">La Fourmi et la Sauterelle</option>
      <option value="tortue">La Tortue et le Li√®vre</option>
      <option value="agneau">Le Loup et l‚ÄôAgneau</option>
      <option value="heron">L‚ÄôH√©ron</option>
    </select>

    <div class="buttons">
      <button onclick="playDictation()">‚ñ∂Ô∏è √âcouter</button>
      <button onclick="togglePause()">‚è∏Ô∏è Pause / Reprendre</button>
      <button onclick="slowDown()">üê¢ Ralentir</button>
      <button onclick="speedUp()">üêá Acc√©l√©rer</button>
      <button onclick="checkDictation()">‚úÖ V√©rifier</button>
    </div>

    <textarea id="userInput" placeholder="√âcris ici ta dict√©e..."></textarea>

    <div id="result"></div>
  </div>

  <script>
    const dictations = {
      laboureur: `Travaillez, prenez de la peine :
C'est le fonds qui manque le moins.
Un riche Laboureur, sentant sa mort prochaine,
Fit venir ses enfants, leur parla sans t√©moins.
Gardez-vous, leur dit-il, de vendre l'h√©ritage
Que nous ont laiss√© nos parents.
Un tr√©sor est cach√© dedans.
Je ne sais pas l'endroit ; mais un peu de courage
Vous le fera trouver, vous en viendrez √† bout.
Remuez votre champ d√®s qu'on aura fait l'O√ªt.
Creusez, fouillez, b√™chez ; ne laissez nulle place
O√π la main ne passe et repasse...`,

      cigale: `La Cigale, ayant chant√© Tout l'√©t√©,
Se trouva fort d√©pourvue Quand la bise fut venue :
Pas un seul petit morceau De mouche ou de vermisseau.
Elle alla crier famine Chez la Fourmi sa voisine...`,

      lievre: `Tout le monde savait que le Li√®vre √©tait l'animal le plus rapide...
Un jour, le Li√®vre proposa une course √† la Tortue. La Chouette donna le d√©part.
Le Li√®vre partit vite, s'arr√™ta pour dormir... et la Tortue gagna la course.`,

      tortue: `Rien ne sert de courir ; il faut partir √† point.
Le Li√®vre et la Tortue en sont un t√©moignage...
La Tortue arriva la premi√®re. Eh bien ! lui cria-t-elle, avais-je pas raison ?`,

      corbeau: `Ma√Ætre Corbeau, sur un arbre perch√©,
Tenait en son bec un fromage.
Ma√Ætre Renard, par l'odeur all√©ch√©,
Lui tint √† peu pr√®s ce langage : ...`,

      grenouille: `Une Grenouille vit un B≈ìuf Qui lui sembla de belle taille.
Elle qui n'√©tait pas grosse en tout comme un ≈ìuf,
Envieuse s'√©tend, s'enfle, et cr√®ve...`,

      fourmi: `Nous √©tions au milieu de l'hiver, un jour clair et glacial...
La Sauterelle affam√©e demanda des graines √† la Fourmi,
Mais cette derni√®re lui r√©pondit que ceux qui ne travaillent pas auront faim.`,

      agneau: `La raison du plus fort est toujours la meilleure :
Un Agneau se d√©salt√©rait Dans le courant d'une onde pure.
Un Loup survint √† jeun et l'accusa faussement...
Il le mangea.`,

      heron: `Un jour, sur ses longs pieds, allait je ne sais o√π,
Le H√©ron au long bec emmanch√© d'un long cou...
Il d√©daigna les poissons faciles, et finit par manger un lima√ßon.`
    };

    let rate = 0.5;
    const minRate = 0.25;
    const maxRate = 2.0;
    let paused = false;
    let speaking = false;
    let queue = [];

    function getVoice() {
      const voices = speechSynthesis.getVoices();
      return (
        voices.find(v => v.lang === 'fr-FR' && /thomas|paul|yves|homme/i.test(v.name)) ||
        voices.find(v => v.lang === 'fr-FR')
      );
    }

    function speak(text) {
      speechSynthesis.cancel();
      queue = [];

      const parts = text
        .replace(/\n/g, ' ')
        .split(/([.,;:!?])/g)
        .filter(p => p.trim() !== '')
        .map(part => {
          if (part === '.') return 'point';
          if (part === ',') return 'virgule';
          if (part === ';') return 'point-virgule';
          if (part === ':') return 'deux-points';
          if (part === '!') return 'point d\'exclamation';
          if (part === '?') return 'point d\'interrogation';
          return part.trim();
        });

      for (let part of parts) {
        const utterance = new SpeechSynthesisUtterance(part);
        utterance.lang = 'fr-FR';
        utterance.voice = getVoice();
        utterance.rate = rate;

        queue.push(utterance);

        if (['point', 'virgule', 'point-virgule', 'deux-points', 'point d\'exclamation', 'point d\'interrogation'].includes(part)) {
          queue.push('pause');
        }
      }

      speaking = true;
      playQueue();
    }

    async function playQueue() {
      for (let item of queue) {
        while (paused) await new Promise(r => setTimeout(r, 100));
        if (!speaking) return;

        if (item === 'pause') {
          await new Promise(r => setTimeout(r, 500));
        } else {
          speechSynthesis.speak(item);
          await new Promise(resolve => {
            item.onend = resolve;
          });
        }
      }

      speaking = false;
    }

    function playDictation() {
      const selected = document.getElementById('dictationSelect').value;
      const text = dictations[selected];
      if (text) {
        paused = false;
        speaking = true;
        speak(text);
      }
    }

    function togglePause() {
      paused = !paused;
      if (paused) {
        speechSynthesis.pause();
      } else {
        speechSynthesis.resume();
      }
    }

    function slowDown() {
      if (rate > minRate) {
        rate -= 0.1;
        if (rate < minRate) rate = minRate;
      }
    }

    function speedUp() {
      if (rate < maxRate) {
        rate += 0.1;
        if (rate > maxRate) rate = maxRate;
      }
    }

    function checkDictation() {
      const selected = document.getElementById('dictationSelect').value;
      const original = dictations[selected].replace(/\s+/g, ' ').trim().toLowerCase();
      const userText = document.getElementById('userInput').value.replace(/\s+/g, ' ').trim().toLowerCase();

      const result = original === userText
        ? '‚úÖ Parfait ! Aucune erreur d√©tect√©e.'
        : '‚ùå Il y a des diff√©rences. Relis ta dict√©e et r√©essaie !';

      document.getElementById('result').textContent = result;
    }

    // Chargement des voix
    window.speechSynthesis.onvoiceschanged = () => {
      getVoice();
    };
  </script>
</body>
</html>
