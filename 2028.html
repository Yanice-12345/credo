<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dict√©e Interactive</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(270deg, #6a11cb, #2575fc, #6a11cb);
      background-size: 600% 600%;
      animation: gradientAnimation 15s ease infinite;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
    }

    @keyframes gradientAnimation {
      0% {background-position: 0% 50%;}
      50% {background-position: 100% 50%;}
      100% {background-position: 0% 50%;}
    }

    .container {
      background: rgba(255,255,255,0.1);
      padding: 30px;
      border-radius: 16px;
      max-width: 700px;
      width: 100%;
      text-align: center;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0,0,0,0.25);
    }

    h1 {
      margin-bottom: 20px;
      font-size: 1.8rem;
    }

    select, textarea, button {
      width: 100%;
      margin-top: 12px;
      padding: 12px;
      font-size: 1rem;
      border-radius: 8px;
      border: none;
      outline: none;
    }

    textarea {
      height: 180px;
      resize: vertical;
      background: rgba(255,255,255,0.9);
      color: #333;
    }

    select {
      background: rgba(255,255,255,0.9);
      color: #333;
    }

    .buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 15px;
    }

    .buttons button {
      flex: 1 1 calc(50% - 10px);
      background: #fff;
      color: #2575fc;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s;
    }

    .buttons button:hover {
      background: #2575fc;
      color: #fff;
    }

    #result {
      margin-top: 15px;
      font-weight: bold;
      min-height: 1.2em;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>üìú Dict√©e Interactive</h1>

    <select id="dictationSelect">
      <option value="laboureur">Le Laboureur et ses enfants</option>
      <option value="cigale">La Cigale et la Fourmi</option>
    </select>

    <div class="buttons">
      <button onclick="playDictation()">‚ñ∂Ô∏è √âcouter</button>
      <button onclick="togglePause()">‚è∏Ô∏è Pause / Reprendre</button>
      <button onclick="slowDown()">üê¢ Ralentir</button>
      <button onclick="speedUp()">üêá Acc√©l√©rer</button>
      <button onclick="checkDictation()">‚úÖ V√©rifier</button>
    </div>

    <textarea id="userInput" placeholder="√âcris ici ta dict√©e..."></textarea>

    <div id="result"></div>
  </div>

  <script>
    const dictations = {
      laboureur: `Travaillez, prenez de la peine :
C'est le fonds qui manque le moins.
Un riche Laboureur, sentant sa mort prochaine,
Fit venir ses enfants, leur parla sans t√©moins.
Gardez-vous, leur dit-il, de vendre l'h√©ritage
Que nous ont laiss√© nos parents.
Un tr√©sor est cach√© dedans.
Je ne sais pas l'endroit ; mais un peu de courage
Vous le fera trouver, vous en viendrez √† bout.
Remuez votre champ d√®s qu'on aura fait l'O√ªt.
Creusez, fouillez, b√™chez ; ne laissez nulle place
O√π la main ne passe et repasse...`,

      cigale: `La Cigale, ayant chant√© tout l'√©t√©,
Se trouva fort d√©pourvue quand la bise fut venue :
Pas un seul petit morceau de mouche ou de vermisseau.
Elle alla crier famine chez la Fourmi sa voisine...`
    };

    let rate = 0.9;
    const minRate = 0.5;
    const maxRate = 2.0;
    let paused = false;
    let speaking = false;
    let queue = [];

    function getVoice() {
      const voices = speechSynthesis.getVoices();
      return voices.find(v => v.lang === 'fr-FR') || voices[0];
    }

    function speak(text) {
      speechSynthesis.cancel();
      queue = [];

      const parts = text
        .replace(/\n/g, ' ')
        .split(/([.,;:!?])/g)
        .filter(p => p.trim() !== '')
        .map(part => {
          if (part === '.') return 'point';
          if (part === ',') return 'virgule';
          if (part === ';') return 'point-virgule';
          if (part === ':') return 'deux-points';
          if (part === '!') return 'point d\'exclamation';
          if (part === '?') return 'point d\'interrogation';
          return part.trim();
        });

      for (let part of parts) {
        const utterance = new SpeechSynthesisUtterance(part);
        utterance.lang = 'fr-FR';
        utterance.voice = getVoice();
        utterance.rate = rate;

        queue.push({ type: 'speak', utterance });

        if (part === 'point d\'interrogation') {
          queue.push({ type: 'pause', duration: 5000 });
        } else if (['point', 'virgule', 'point-virgule', 'deux-points', 'point d\'exclamation'].includes(part)) {
          queue.push({ type: 'pause', duration: 500 });
        }
      }

      speaking = true;
      playQueue();
    }

    async function playQueue() {
      for (let item of queue) {
        while (paused) await new Promise(r => setTimeout(r, 100));
        if (!speaking) return;

        if (item.type === 'pause') {
          await new Promise(r => setTimeout(r, item.duration));
        } else if (item.type === 'speak') {
          speechSynthesis.speak(item.utterance);
          await new Promise(resolve => {
            item.utterance.onend = resolve;
          });
        }
      }
      speaking = false;
    }

    function playDictation() {
      const selected = document.getElementById('dictationSelect').value;
      const text = dictations[selected];
      if (text) {
        paused = false;
        speaking = true;
        speak(text);
      }
    }

    function togglePause() {
      paused = !paused;
      if (paused) {
        speechSynthesis.pause();
      } else {
        speechSynthesis.resume();
      }
    }

    function slowDown() {
      if (rate > minRate) rate = Math.max(rate - 0.1, minRate);
    }

    function speedUp() {
      if (rate < maxRate) rate = Math.min(rate + 0.1, maxRate);
    }

    function checkDictation() {
      const selected = document.getElementById('dictationSelect').value;
      const original = dictations[selected];
      const userText = document.getElementById('userInput').value;

      const normalizedOriginal = original.replace(/\s+/g, ' ').trim().toLowerCase();
      const normalizedUser = userText.replace(/\s+/g, ' ').trim().toLowerCase();

      const result = normalizedOriginal === normalizedUser
        ? '‚úÖ Parfait ! Aucune erreur d√©tect√©e.\n\n'
        : '‚ùå Il y a des erreurs. Relis ta dict√©e et r√©essaie !\n\n';

      document.getElementById('result').textContent = result + "üìú Texte original :\n" + original;
    }

    window.speechSynthesis.onvoiceschanged = () => {
      getVoice();
    };
  </script>
</body>
</html>
