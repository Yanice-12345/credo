<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dict√©e Interactive</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(270deg, #6a11cb, #2575fc, #6a11cb);
      background-size: 600% 600%;
      animation: gradientAnimation 15s ease infinite;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
    }

    @keyframes gradientAnimation {
      0% {background-position: 0% 50%;}
      50% {background-position: 100% 50%;}
      100% {background-position: 0% 50%;}
    }

    .container {
      background: rgba(255,255,255,0.1);
      padding: 30px;
      border-radius: 16px;
      max-width: 700px;
      width: 100%;
      text-align: center;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0,0,0,0.25);
    }

    h1 {
      margin-bottom: 20px;
      font-size: 1.8rem;
    }

    select, textarea, button {
      width: 100%;
      margin-top: 12px;
      padding: 12px;
      font-size: 1rem;
      border-radius: 8px;
      border: none;
      outline: none;
    }

    textarea {
      height: 180px;
      resize: vertical;
      background: rgba(255,255,255,0.9);
      color: #333;
    }

    select {
      background: rgba(255,255,255,0.9);
      color: #333;
    }

    .buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 15px;
    }

    .buttons button {
      flex: 1 1 calc(50% - 10px);
      background: #fff;
      color: #2575fc;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s;
    }

    .buttons button:hover {
      background: #2575fc;
      color: #fff;
    }

    #result {
      margin-top: 15px;
      font-weight: bold;
      min-height: 1.2em;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>üìú Dict√©e Interactive</h1>

    <select id="dictationSelect">
      <option value="laboureur">Le laboureur et ses enfants</option>
      <option value="cigale">La Cigale et la Fourmi</option>
    </select>

    <div class="buttons">
      <button onclick="playDictation()">‚ñ∂Ô∏è √âcouter</button>
      <button onclick="togglePause()">‚è∏Ô∏è Pause / Reprendre</button>
      <button onclick="slowDown()">üê¢ Ralentir</button>
      <button onclick="speedUp()">üêá Acc√©l√©rer</button>
      <button onclick="checkDictation()">‚úÖ V√©rifier</button>
    </div>

    <textarea id="userInput" placeholder="√âcris ici ta dict√©e..."></textarea>

    <div id="result"></div>
  </div>

  <script>
    const dictations = {
      laboureur: `Travaillez, prenez de la peine :\nC'est le fonds qui manque le moins.\nUn riche Laboureur, sentant sa mort prochaine,\nFit venir ses enfants, leur parla sans t√©moins.\nGardez-vous, leur dit-il, de vendre l'h√©ritage\nQue nous ont laiss√© nos parents.\nUn tr√©sor est cach√© dedans.\nJe ne sais pas l'endroit ; mais un peu de courage\nVous le fera trouver, vous en viendrez √† bout.\nRemuez votre champ d√®s qu'on aura fait l'O√ªt.\nCreusez, fouillez, b√™chez ; ne laissez nulle place\nO√π la main ne passe et repasse.\nLe p√®re mort, les fils vous retournent le champ\nDe√ß√†, del√†, partout ; si bien qu'au bout de l'an\nIl en rapporta davantage.\nD'argent, point de cach√©. Mais le p√®re fut sage\nDe leur montrer avant sa mort\nQue le travail est un tr√©sor.`,
      cigale: `La Cigale, ayant chant√© Tout l'√©t√©,\nSe trouva fort d√©pourvue Quand la bise fut venue :\nPas un seul petit morceau De mouche ou de vermisseau.\nElle alla crier famine Chez la Fourmi sa voisine,\nLa priant de lui pr√™ter Quelque grain pour subsister\nJusqu'√† la saison nouvelle. ¬´ Je vous paierai, lui dit-elle,\nAvant l'ao√ªt, foi d'animal, Int√©r√™t et principal. ¬ª\nLa Fourmi n'est pas pr√™teuse : C'est l√† son moindre d√©faut.\n¬´ Que faisiez-vous au temps chaud ? Dit-elle √† cette emprunteuse.\n‚Äî Nuit et jour √† tout venant Je chantais, ne vous d√©plaise.\n‚Äî Vous chantiez ? j'en suis fort aise ; Eh bien dansez maintenant. ¬ª`
    };

    let rate = 0.5;
    const minRate = 0.25;
    const maxRate = 2.0;
    let paused = false;
    let speaking = false;
    let queue = [];

    function getVoice() {
      const voices = speechSynthesis.getVoices();
      return voices.find(v => v.lang === 'fr-FR' && v.name.toLowerCase().includes('homme')) || voices.find(v => v.lang === 'fr-FR');
    }

    function speak(text) {
      speechSynthesis.cancel();
      queue = [];

      const parts = text
        .replace(/\n/g, ' ')
        .split(/([.,;:!?])/g)
        .filter(p => p.trim() !== '');

      for (let i = 0; i < parts.length; i++) {
        const part = parts[i].trim();
        if (part === '') continue;

        const utterance = new SpeechSynthesisUtterance(part);
        utterance.lang = 'fr-FR';
        utterance.voice = getVoice();
        utterance.rate = rate;

        queue.push(utterance);

        if (/[.,;:!?]/.test(part)) {
          queue.push('pause');
        }
      }

      speaking = true;
      playQueue();
    }

    async function playQueue() {
      for (let item of queue) {
        while (paused) await new Promise(r => setTimeout(r, 100));
        if (!speaking) return;

        if (item === 'pause') {
          await new Promise(r => setTimeout(r, 5000));
        } else {
          speechSynthesis.speak(item);
          await new Promise(resolve => {
            item.onend = resolve;
          });
        }
      }
      speaking = false;
    }

    function playDictation() {
      const sel = document.getElementById('dictationSelect').value;
      paused = false;
      speaking = true;
      speak(dictations[sel]);
    }

    function togglePause() {
      if (!speaking) return;
      paused = !paused;
      if (paused) {
        speechSynthesis.pause();
      } else {
        speechSynthesis.resume();
      }
    }

    function slowDown() {
      rate = Math.max(minRate, rate - 0.1);
      playDictation();
    }

    function speedUp() {
      rate = Math.min(maxRate, rate + 0.1);
      playDictation();
    }

    function normalize(str) {
      return str
        .toLowerCase()
        .replace(/[.,;:!?¬´¬ª"‚Äù‚Äú‚Äô‚Äò]/g, '')
        .replace(/\s+/g, ' ')
        .trim();
    }

    function checkDictation() {
      const sel = document.getElementById('dictationSelect').value;
      const original = dictations[sel];
      const originalNormalized = normalize(original);
      const user = normalize(document.getElementById('userInput').value);
      const res = document.getElementById('result');

      if (user === originalNormalized) {
        res.innerHTML = `<div style="color:#00e676;">‚úÖ Parfait, ta dict√©e est exacte !</div><pre>${original}</pre>`;
      } else {
        res.innerHTML = `<div style="color:#ff5252;">‚ùå Des erreurs restent √† corriger.</div><pre>${original}</pre>`;
      }
    }

    // S'assure que les voix sont charg√©es (important pour certains navigateurs)
    window.speechSynthesis.onvoiceschanged = () => {};
  </script>
</body>
</html>