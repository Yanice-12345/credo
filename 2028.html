<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dictée Interactive</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(270deg, #6a11cb, #2575fc, #6a11cb);
      background-size: 600% 600%;
      animation: gradientAnimation 15s ease infinite;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
    }

    @keyframes gradientAnimation {
      0% {background-position: 0% 50%;}
      50% {background-position: 100% 50%;}
      100% {background-position: 0% 50%;}
    }

    .container {
      background: rgba(255,255,255,0.1);
      padding: 30px;
      border-radius: 16px;
      max-width: 700px;
      width: 100%;
      text-align: center;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0,0,0,0.25);
    }

    h1 {
      margin-bottom: 20px;
      font-size: 1.8rem;
    }

    select, textarea, button {
      width: 100%;
      margin-top: 12px;
      padding: 12px;
      font-size: 1rem;
      border-radius: 8px;
      border: none;
      outline: none;
    }

    textarea {
      height: 180px;
      resize: vertical;
      background: rgba(255,255,255,0.9);
      color: #333;
    }

    select {
      background: rgba(255,255,255,0.9);
      color: #333;
    }

    .buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 15px;
    }

    .buttons button {
      flex: 1 1 calc(50% - 10px);
      background: #fff;
      color: #2575fc;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s;
    }

    .buttons button:hover {
      background: #2575fc;
      color: #fff;
    }

    #result {
      margin-top: 15px;
      font-weight: bold;
      min-height: 1.2em;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>📜 Dictée Interactive</h1>

    <select id="dictationSelect">
      <option value="laboureur">Le laboureur et ses enfants</option>
      <option value="cigale">La Cigale et la Fourmi</option>
    </select>

    <div class="buttons">
      <button onclick="playDictation()">▶️ Écouter</button>
      <button onclick="togglePause()">⏸️ Pause / Reprendre</button>
      <button onclick="slowDown()">🐢 Ralentir</button>
      <button onclick="speedUp()">🐇 Accélérer</button>
      <button onclick="checkDictation()">✅ Vérifier</button>
    </div>

    <textarea id="userInput" placeholder="Écris ici ta dictée..."></textarea>

    <div id="result"></div>
  </div>


  <script>
    const dictations = {
      laboureur: `Travaillez, prenez de la peine :\nC'est le fonds qui manque le moins.\nUn riche Laboureur, sentant sa mort prochaine,\nFit venir ses enfants, leur parla sans témoins.\nGardez-vous, leur dit-il, de vendre l'héritage\nQue nous ont laissé nos parents.\nUn trésor est caché dedans.\nJe ne sais pas l'endroit ; mais un peu de courage\nVous le fera trouver, vous en viendrez à bout.\nRemuez votre champ dès qu'on aura fait l'Oût.\nCreusez, fouillez, bêchez ; ne laissez nulle place\nOù la main ne passe et repasse.\nLe père mort, les fils vous retournent le champ\nDeçà, delà, partout ; si bien qu'au bout de l'an\nIl en rapporta davantage.\nD'argent, point de caché. Mais le père fut sage\nDe leur montrer avant sa mort\nQue le travail est un trésor.`,

      cigale: `La Cigale, ayant chanté Tout l'été,\nSe trouva fort dépourvue Quand la bise fut venue :\nPas un seul petit morceau De mouche ou de vermisseau.\nElle alla crier famine Chez la Fourmi sa voisine,\nLa priant de lui prêter Quelque grain pour subsister\nJusqu'à la saison nouvelle. « Je vous paierai, lui dit-elle,\nAvant l'août, foi d'animal, Intérêt et principal. »\nLa Fourmi n'est pas prêteuse : C'est là son moindre défaut.\n« Que faisiez-vous au temps chaud ? Dit-elle à cette emprunteuse.\n— Nuit et jour à tout venant Je chantais, ne vous déplaise.\n— Vous chantiez ? j'en suis fort aise ; Eh bien dansez maintenant. »`
    };

Lièvre: `Tout le monde savait que le Lièvre était l'animal le plus rapide, et le Lièvre adorait s'en vanter. « Jamais un animal n'a été, n'est ou ne sera aussi rapide que moi, clamait-il. Personne ne peut me battre ! »
Un jour de grande chaleur, le Lièvre cherchait quelqu'un pour faire la course, tout en fanfaronnant se vantant, comme à son habitude. Il rencontra la Tortue qui passait par là de son pas lent. Elle accepta le défi que lui proposa le Lièvre.
Ils demandèrent à la Chouette de donner le signal : il fallait faire le tour du parc et revenir au point de départ. La Chouette hulula signifiant ainsi le début de la course. Le Lièvre fut bientôt arrivé à mi-parcours. Alors, il s'arrêta pour déjeuner. La Tortue, loin derrière, continuait de son pas lent.
Comme il ne voyait pas venir la Tortue, le Lièvre fit une petite sieste. La Tortue poursuivit son chemin pesamment.
Le Lièvre dormit tout l'après-midi. Quand il s'éveilla, il aperçut la Tortue, au loin, qui s'approchait lentement de la ligne d'arrivée. Pour essayer de rattraper la Tortue, le Lièvre détala si bien qu'on distinguait à peine ses pattes et que ses longues oreilles étaient rabattues en arrière. Mais il arriva trop tard. C'est la Tortue qui remporta la course...d'une encolure.
En gardant une allure constante.`
    };


Lièvre: `Tout le monde savait que le Lièvre était l'animal le plus rapide, et le Lièvre adorait s'en vanter. « Jamais un animal n'a été, n'est ou ne sera aussi rapide que moi, clamait-il. Personne ne peut me battre ! »
Un jour de grande chaleur, le Lièvre cherchait quelqu'un pour faire la course, tout en fanfaronnant se vantant, comme à son habitude. Il rencontra la Tortue qui passait par là de son pas lent. Elle accepta le défi que lui proposa le Lièvre.
Ils demandèrent à la Chouette de donner le signal : il fallait faire le tour du parc et revenir au point de départ. La Chouette hulula signifiant ainsi le début de la course. Le Lièvre fut bientôt arrivé à mi-parcours. Alors, il s'arrêta pour déjeuner. La Tortue, loin derrière, continuait de son pas lent.
Comme il ne voyait pas venir la Tortue, le Lièvre fit une petite sieste. La Tortue poursuivit son chemin pesamment.
Le Lièvre dormit tout l'après-midi. Quand il s'éveilla, il aperçut la Tortue, au loin, qui s'approchait lentement de la ligne d'arrivée. Pour essayer de rattraper la Tortue, le Lièvre détala si bien qu'on distinguait à peine ses pattes et que ses longues oreilles étaient rabattues en arrière. Mais il arriva trop tard. C'est la Tortue qui remporta la course...d'une encolure.
En gardant une allure constante.`
    };



Le corbeau et le renard: `Maître Corbeau, sur un arbre perché,
Tenait en son bec un fromage.
Maître Renard, par l'odeur alléché,
Lui tint à peu près ce langage :
Et bonjour, Monsieur du Corbeau.
Que vous êtes joli ! que vous me semblez beau !
Sans mentir, si votre ramage
Se rapporte à votre plumage,
Vous êtes le Phénix des hôtes de ces bois.
À ces mots, le Corbeau ne se sent pas de joie ;
Et pour montrer sa belle voix,
Il ouvre un large bec, laisse tomber sa proie.
Le Renard s'en saisit, et dit : Mon bon Monsieur,
Apprenez que tout flatteur
Vit aux dépens de celui qui l'écoute.
Cette leçon vaut bien un fromage, sans doute.
Le Corbeau honteux et confus
Jura, mais un peu tard, qu'on ne l'y prendrait plus.`
    };


Grenouille: `Une Grenouille vit un bœuf
Qui lui sembla de belle taille.
Elle qui n'était pas grosse en tout comme un œuf,
Envieuse s'étend, et s'enfle, et se travaille
Pour égaler l'animal en grosseur,
Disant : Regardez bien, ma sœur ;
Est-ce assez ? dites-moi ; n'y suis-je point encore ?
— Nenni. — M'y voici donc ? — Point du tout. — M'y voilà ?
— Vous n'en approchez point. La chétive pécore
S'enfla si bien qu'elle creva.
Le monde est plein de gens qui ne sont pas plus sages :
Tout Bourgeois veut bâtir comme les grands Seigneurs,
Tout petit Prince a des Ambassadeurs,
Tout Marquis veut avoir des Pages.`
    };



Fourmi: `Nous étions au milieu de l'hiver, un jour clair et glacial. Malgré le froid, la Fourmi se chauffait au soleil. Elle mâchonnait quelques graines provenant d'un gros tas qu'elle avait péniblement « amoncelé » tout au long de l'été.
Tandis que la Fourmi mangeait, la Sauterelle arriva, son estomac criant famine. S'adressant à la Fourmi, elle quémanda une ou deux graines.
« Eh bien, demanda la Fourmi, que faisiez-vous durant l'été ? »
« Je sautais de feuille en feuille, je les mordillais, je chantais », répliqua la Sauterelle.
« Vous n'avez rien mis de côté en prévision de l'hiver ? » interrogea la Fourmi.
La Sauterelle secoua la tête tristement.
«Toutes les mêmes, ces sauterelles», dit la Fourmi. Puis elle donna quelques graines à la Sauterelle, et la renvoya avec ces mots :
« Ceux qui ne travaillent pas en été auront faim en hiver. »`
    };
7.



Fourmi: `Nous étions au milieu de l'hiver, un jour clair et glacial. Malgré le froid, la Fourmi se chauffait au soleil. Elle mâchonnait quelques graines provenant d'un gros tas qu'elle avait péniblement « amoncelé » tout au long de l'été.
Tandis que la Fourmi mangeait, la Sauterelle arriva, son estomac criant famine. S'adressant à la Fourmi, elle quémanda une ou deux graines.
« Eh bien, demanda la Fourmi, que faisiez-vous durant l'été ? »
« Je sautais de feuille en feuille, je les mordillais, je chantais », répliqua la Sauterelle.
« Vous n'avez rien mis de côté en prévision de l'hiver ? » interrogea la Fourmi.
La Sauterelle secoua la tête tristement.
«Toutes les mêmes, ces sauterelles», dit la Fourmi. Puis elle donna quelques graines à la Sauterelle, et la renvoya avec ces mots :
« Ceux qui ne travaillent pas en été auront faim en hiver. »`
    };


Fourmi: `Nous étions au milieu de l'hiver, un jour clair et glacial. Malgré le froid, la Fourmi se chauffait au soleil. Elle mâchonnait quelques graines provenant d'un gros tas qu'elle avait péniblement « amoncelé » tout au long de l'été.
Tandis que la Fourmi mangeait, la Sauterelle arriva, son estomac criant famine. S'adressant à la Fourmi, elle quémanda une ou deux graines.
« Eh bien, demanda la Fourmi, que faisiez-vous durant l'été ? »
« Je sautais de feuille en feuille, je les mordillais, je chantais », répliqua la Sauterelle.
« Vous n'avez rien mis de côté en prévision de l'hiver ? » interrogea la Fourmi.
La Sauterelle secoua la tête tristement.
«Toutes les mêmes, ces sauterelles», dit la Fourmi. Puis elle donna quelques graines à la Sauterelle, et la renvoya avec ces mots :
« Ceux qui ne travaillent pas en été auront faim en hiver. »`
    };




Tortue: `Rien ne sert de courir ; il faut partir à point.
Le Lièvre et la Tortue en sont un témoignage.
Gageons, dit celle-ci, que vous n'atteindrez point
Sitôt que moi ce but. — Sitôt ? Êtes-vous sage ?
Repartit l'animal léger.
Ma commère, il vous faut purger
Avec quatre grains d'ellébore.
— Sage ou non, je parie encore.
Ainsi fut fait : et de tous deux
On mit près du but les enjeux :
Savoir quoi, ce n'est pas l'affaire,
Ni de quel juge l'on convint.
Notre Lièvre n'avait que quatre pas à faire ;
J'entends de ceux qu'il fait lorsque prêt d'être atteint
Il s'éloigne des chiens, les renvoie aux Calendes,
Et leur fait arpenter les landes.
Ayant, dis-je, du temps de reste pour brouter,
Pour dormir, et pour écouter
D'où vient le vent, il laisse la Tortue
Aller son train de Sénateur.
Elle part, elle s'évertue ;
Elle se hâte avec lenteur.
Lui cependant méprise une telle victoire,
Tient la gageure à peu de gloire,
Croit qu'il y va de son honneur
De partir tard. Il broute, il se repose,
Il s'amuse à toute autre chose
Qu'à la gageure. À la fin quand il vit
Que l'autre touchait presque au bout de la carrière,
Il partit comme un trait ; mais les élans qu'il fit
Furent vains : la Tortue arriva la première.
Eh bien ! lui cria-t-elle, avais-je pas raison ?
De quoi vous sert votre vitesse ?
Moi, l'emporter ! et que serait-ce
Si vous portiez une maison ?`
    };




Agneau: `La raison du plus fort est toujours la meilleure :
Nous l'allons montrer tout à l'heure.
Un Agneau se désaltérait
Dans le courant d'une onde pure.
Un Loup survient à jeun qui cherchait aventure,
Et que la faim en ces lieux attirait.
Qui te rend si hardi de troubler mon breuvage ?
Dit cet animal plein de rage :
Tu seras châtié de ta témérité.
— Sire, répond l'Agneau, que votre Majesté
Ne se mette pas en colère ;
Mais plutôt qu'elle considère
Que je me vas désaltérant
Dans le courant,
Plus de vingt pas au-dessous d'Elle,
Et que par conséquent, en aucune façon,
Je ne puis troubler sa boisson.
— Tu la troubles, reprit cette bête cruelle,
Et je sais que de moi tu médis l'an passé.
— Comment l'aurais-je fait si je n'étais pas né ?
Reprit l'Agneau, je tette encore ma mère.
— Si ce n'est toi, c'est donc ton frère.
— Je n'en ai point.
— C'est donc quelqu'un des tiens :
Car vous ne m'épargnez guère,
Vous, vos bergers, et vos chiens.
On me l'a dit : il faut que je me venge.
Là-dessus, au fond des forêts
Le Loup l'emporte, et puis le mange.`
    };



Agneau: `Un jour, sur ses longs pieds, allait je ne sais où,
Le Héron au long bec emmanché d'un long cou.
Il côtoyait une rivière.
L'onde était transparente ainsi qu'aux plus beaux jours ;
Ma commère la carpe y faisait mille tours
Avec le brochet son compère.
Le Héron en eût fait aisément son profit :
Tous approchaient du bord, l'oiseau n'avait qu'à prendre ;
Mais il crut mieux faire d'attendre
Qu'il eût un peu plus d'appétit.
Il vivait de régime, et mangeait à ses heures.
Après quelques moments l'appétit vint : l'oiseau
S'approchant du bord vit sur l'eau
Des Tanches qui sortaient du fond de ces demeures.
Le mets ne lui plut pas ; il s'attendait à mieux
Et montrait un goût dédaigneux
Comme le rat du bon Horace.
Moi des Tanches ? dit-il, moi Héron que je fasse
Une si pauvre chère ? Et pour qui me prend-on ?
La Tanche rebutée il trouva du goujon.
Du goujon ! c'est bien là le dîner d'un Héron !
J'ouvrirais pour si peu le bec ! aux Dieux ne plaise !
Il l'ouvrit pour bien moins : tout alla de façon
Qu'il ne vit plus aucun poisson.
La faim le prit, il fut tout heureux et tout aise
De rencontrer un limaçon.
Ne soyons pas si difficiles :
Les plus accommodants ce sont les plus habiles :
On hasarde de perdre en voulant trop gagner,
Gardez-vous de rien dédaigner ;
Surtout quand vous avez à peu près votre compte.
Bien des gens y sont pris ; ce n'est pas aux Hérons
Que je parle ; écoutez, humains, un autre conte ;
Vous verrez que chez vous j'ai puisé ces leçons.`
    };



  let rate = 0.5;
  const minRate = 0.25;
  const maxRate = 2.0;
  let paused = false;
  let speaking = false;
  let queue = [];

  function getVoice() {
    const voices = speechSynthesis.getVoices();
    // Privilégie une voix masculine bien articulée en français
    return (
      voices.find(v => v.lang === 'fr-FR' && /thomas|paul|yves|homme/i.test(v.name)) ||
      voices.find(v => v.lang === 'fr-FR')
    );
  }

  function speak(text) {
    speechSynthesis.cancel();
    queue = [];

    // Ajoute les mots des ponctuations
    const parts = text
      .replace(/\n/g, ' ')
      .split(/([.,;:!?])/g)
      .filter(p => p.trim() !== '')
      .map(part => {
        if (part === '.') return 'point';
        if (part === ',') return 'virgule';
        if (part === ';') return 'point-virgule';
        if (part === ':') return 'deux-points';
        if (part === '!') return 'point d\'exclamation';
        if (part === '?') return 'point d\'interrogation';
        return part.trim();
      });

    for (let part of parts) {
      const utterance = new SpeechSynthesisUtterance(part);
      utterance.lang = 'fr-FR';
      utterance.voice = getVoice();
      utterance.rate = rate;

      queue.push(utterance);

      if (['point', 'virgule', 'point-virgule', 'deux-points', 'point d\'exclamation', 'point d\'interrogation'].includes(part)) {
        queue.push('pause');
      }
    }

    speaking = true;
    playQueue();
  }

  async function playQueue() {
    for (let item of queue) {
      while (paused) await new Promise(r => setTimeout(r, 100));
      if (!speaking) return;

      if (item === 'pause') {
        await new Promise(r => setTimeout(r, 5000));
      } else {
        speechSynthesis.speak(item);
        await new Promise(resolve => {
          item.onend = resolve;
        });
      }
    }
    speaking = false;
  }

  function playDictation() {
    const sel = document.getElementById('dictationSelect').value;
    paused = false;
    speaking = true;
    speak(dictations[sel]);
  }

  function togglePause() {
    if (!speaking) return;
    paused = !paused;
    if (paused) {
      speechSynthesis.pause();
    } else {
      speechSynthesis.resume();
    }
  }

  function slowDown() {
    rate = Math.max(minRate, rate - 0.1);
    playDictation();
  }

  function speedUp() {
    rate = Math.min(maxRate, rate + 0.1);
    playDictation();
  }

  function normalize(str) {
    return str
      .toLowerCase()
      .replace(/[.,;:!?«»"”“’‘]/g, '')
      .replace(/\s+/g, ' ')
      .trim();
  }

  function checkDictation() {
    const sel = document.getElementById('dictationSelect').value;
    const original = dictations[sel];
    const originalNormalized = normalize(original);
    const user = normalize(document.getElementById('userInput').value);
    const res = document.getElementById('result');

    if (user === originalNormalized) {
      res.innerHTML = `<div style="color:#00e676;">✅ Parfait, ta dictée est exacte !</div><pre>${original}</pre>`;
    } else {
      res.innerHTML = `<div style="color:#ff5252;">❌ Des erreurs restent à corriger.</div><pre>${original}</pre>`;
    }
  }

  // Assure que les voix sont bien chargées
  window.speechSynthesis.onvoiceschanged = () => {};
</script>