


<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dict√©e Interactive</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(270deg, #6a11cb, #2575fc, #6a11cb);
      background-size: 600% 600%;
      animation: gradientAnimation 15s ease infinite;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
    }

    @keyframes gradientAnimation {
      0% {background-position: 0% 50%;}
      50% {background-position: 100% 50%;}
      100% {background-position: 0% 50%;}
    }

    .container {
      background: rgba(255,255,255,0.1);
      padding: 30px;
      border-radius: 16px;
      max-width: 700px;
      width: 100%;
      text-align: center;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0,0,0,0.25);
    }

    h1 {
      margin-bottom: 20px;
      font-size: 1.8rem;
    }

    select, textarea, button {
      width: 100%;
      margin-top: 12px;
      padding: 12px;
      font-size: 1rem;
      border-radius: 8px;
      border: none;
      outline: none;
    }

    textarea {
      height: 180px;
      resize: vertical;
      background: rgba(255,255,255,0.9);
      color: #333;
    }

    select {
      background: rgba(255,255,255,0.9);
      color: #333;
    }

    .buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 15px;
    }

    .buttons button {
      flex: 1 1 calc(50% - 10px);
      background: #fff;
      color: #2575fc;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s;
    }

    .buttons button:hover {
      background: #2575fc;
      color: #fff;
    }

    #result {
      margin-top: 15px;
      font-weight: bold;
      min-height: 1.2em;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>üìú Dict√©e Interactive</h1>

    <select id="dictationSelect">
      <option value="laboureur">Le Laboureur et ses enfants</option>
      <option value="cigale">La Cigale et la Fourmi</option>
      <option value="lievre">Le Li√®vre et la grenouille</option>
      <option value="corbeau">Le Corbeau et le Renard</option>
      <option value="grenouille">La Grenouille et le B≈ìuf</option>
      <option value="fourmi">La Fourmi et la Sauterelle</option>
      <option value="tortue">La Tortue et le Li√®vre</option>
      <option value="agneau">Le Loup et l‚ÄôAgneau</option>
      <option value="coq">Le Coq et le Renard</option>
      <option value="poisson">Le Petit Poisson</option>
      <option value="cheval">Le Cheval et l‚Äô√Çne</option>
      <option value="pluie">La Pluie et le Beau Temps</option>
      <option value="chat">Le Chat et la Souris</option>
      <option value="chene">Le Vieux Ch√™ne</option>
      <option value="marchand">Le Marchand et son √Çne</option>
      <option value="papillon">Le Papillon et la Fleur</option>
      <option value="pluieEte">La Pluie d‚Äô√ât√©</option>
      <option value="foret">La For√™t Enchant√©e</option>
      <option value="vent">Le Vent et les Feuilles</option>
    </select>

    <div class="buttons">
      <button onclick="playDictation()">‚ñ∂Ô∏è √âcouter</button>
      <button onclick="togglePause()">‚è∏Ô∏è Pause / Reprendre</button>
      <button onclick="slowDown()">üê¢ Ralentir</button>
      <button onclick="speedUp()">üêá Acc√©l√©rer</button>
      <button onclick="checkDictation()">‚úÖ V√©rifier</button>
    </div>

    <textarea id="userInput" placeholder="√âcris ici ta dict√©e..."></textarea>

    <div id="result"></div>
  </div>

  <script>
    const dictations = {
      laboureur: `Travaillez, prenez de la peine : ...`,
      cigale: `La Cigale, ayant chant√© Tout l‚Äô√©t√©...`,
      lievre: `Tout le monde savait que le Li√®vre √©tait...`,
      tortue: `Un Li√®vre en son g√Æte songeait...`,
      corbeau: `Ma√Ætre Corbeau, sur un arbre perch√©...`,
      grenouille: `Une Grenouille vit un B≈ìuf...`,
      fourmi: `Nous √©tions au milieu de l'hiver...`,
      agneau: `La raison du plus fort est toujours la meilleure...`,
      coq: `Sur la branche d‚Äôun arbre √©tait en sentinelle...`,
      poisson: `Un petit poisson nageait dans la rivi√®re claire. Il aimait jouer parmi les algues et les pierres. Un jour, il rencontra une grenouille qui sautait joyeusement sur la berge. ¬´ Bonjour, petit poisson, veux-tu jouer avec moi ? ¬ª demanda la grenouille. Le poisson fit un petit saut et accepta avec plaisir.`,
      cheval: `Un cheval et un √¢ne travaillaient ensemble dans un champ. Le cheval tirait la charrue tandis que l‚Äô√¢ne portait les sacs de graines. Un jour, l‚Äô√¢ne dit au cheval : ¬´ Tu travailles trop dur, laisse-moi t‚Äôaider davantage. ¬ª Le cheval r√©pondit : ¬´ Ensemble, nous pouvons tout accomplir. ¬ª Depuis ce jour, ils travaillaient en √©quipe et √©taient tr√®s heureux.`,
      pluie: `La pluie tombait doucement sur le jardin. Les fleurs buvaient l‚Äôeau avec joie. Puis, le beau temps revint avec un grand soleil. Les oiseaux chantaient et les enfants jouaient dehors. La pluie et le soleil se succ√©daient pour rendre la nature belle.`,
      chat: `Un chat gris regardait une petite souris courir vite. La souris cherchait du fromage pr√®s de la porte. Le chat voulut attraper la souris, mais elle √©tait trop rapide. Finalement, le chat se fatigua et laissa la souris partir. La souris s‚Äôenfuit, heureuse d‚Äôavoir √©chapp√© au chat.`,
      chene: `Un vieux ch√™ne se dressait au milieu du champ. Il avait des branches larges et des feuilles vertes. Les enfants aimaient jouer √† l‚Äôombre de ce ch√™ne. Un jour, une temp√™te forte fit tomber une branche. Mais le vieux ch√™ne resta fier et solide malgr√© les ann√©es.`,
      marchand: `Un marchand avait un √¢ne fid√®le qui l‚Äôaidait √† porter ses marchandises. Chaque jour, ils traversaient le village ensemble. Un matin, l‚Äô√¢ne tomba dans un foss√© profond. Le marchand chercha de l‚Äôaide pour le sauver. Finalement, l‚Äô√¢ne fut tir√© hors du trou, et tous deux reprirent leur chemin.`,
      papillon: `Un joli papillon color√© voletait autour d‚Äôune fleur. Il butinait le nectar avec d√©licatesse. La fleur s‚Äôouvrait sous le soleil chaud de l‚Äô√©t√©. Le papillon dansait de fleur en fleur, heureux. Ils vivaient une belle histoire de nature et de beaut√©.`,
      pluieEte: `La pluie d‚Äô√©t√© tombe souvent en fin d‚Äôapr√®s-midi. Elle rafra√Æchit les champs et les jardins. Les enfants aiment sauter dans les flaques d‚Äôeau. Apr√®s la pluie, un arc-en-ciel appara√Æt dans le ciel bleu. La nature remercie la pluie qui fait tout grandir.`,
      foret: `Dans une for√™t enchant√©e, les arbres parlaient aux voyageurs. Les animaux y vivaient en paix et en harmonie. Un petit gar√ßon s‚Äôaventura dans cette for√™t magique. Il rencontra une f√©e qui lui offrit un cadeau merveilleux. Il rentra chez lui avec un c≈ìur rempli de joie.`,
      vent: `Le vent soufflait fort dans les arbres du parc. Les feuilles rouges et jaunes tourbillonnaient dans l‚Äôair. Elles dansaient une danse folle avant de tomber au sol. Le vent riait en emportant les feuilles au loin. C‚Äô√©tait l‚Äôarriv√©e de l‚Äôautomne, saison des couleurs chaudes.`
    };


    let rate = 0.5;
    const minRate = 0.25;
    const maxRate = 2.0;
    let paused = false;
    let speaking = false;
    let queue = [];
    let voice = null;

    function getVoice() {
      const voices = speechSynthesis.getVoices();
      // On garde la m√™me voix dans la variable globale
      if (!voice) {
        voice = voices.find(v => v.lang === 'fr-FR' && /thomas|paul|yves|homme/i.test(v.name)) || voices.find(v => v.lang === 'fr-FR');
      }
      return voice;
    }

    function speak(text) {
      speechSynthesis.cancel();
      queue = [];

      // D√©coupe en parties mots/ponctuations
      const parts = text
        .replace(/\n/g, ' ')
        .split(/([.,;:!?])/g)
        .filter(p => p.trim() !== '');

      for (let part of parts) {
        // Cr√©ation de l'√©nonc√© √† lire
        let utterance = null;
        if (['.', ',', ';', ':', '!', '?'].includes(part)) {
          // On lit la ponctuation sous forme orale (optionnel)
          // ou on peut ne rien lire et juste faire pause
          utterance = new SpeechSynthesisUtterance(part); 
          utterance.lang = 'fr-FR';
          utterance.voice = getVoice();
          utterance.rate = rate;
          // Marque cette utterance comme ponctuation pour pause plus longue
          utterance.isPunctuation = true;
        } else {
          utterance = new SpeechSynthesisUtterance(part.trim());
          utterance.lang = 'fr-FR';
          utterance.voice = getVoice();
          utterance.rate = rate;
          utterance.isPunctuation = false;
        }
        queue.push(utterance);
      }

      speaking = true;
      playQueue();
    }

    async function playQueue() {
      for (let utterance of queue) {
        while (paused) await new Promise(r => setTimeout(r, 100));
        if (!speaking) return;

        speechSynthesis.speak(utterance);
        await new Promise(resolve => {
          utterance.onend = resolve;
        });

        // Pause de 5 secondes apr√®s une ponctuation, sinon pause de 0.5s
        if (utterance.isPunctuation) {
          await new Promise(r => setTimeout(r, 5000)); 
        } else {
          await new Promise(r => setTimeout(r, 500));
        }
      }
      speaking = false;
    }

    function playDictation() {
      const selected = document.getElementById('dictationSelect').value;
      const text = dictations[selected];
      if (text) {
        paused = false;
        speaking = true;
        speak(text);
      }
    }

    function togglePause() {
      paused = !paused;
      if (paused) {
        speechSynthesis.pause();
      } else {
        speechSynthesis.resume();
      }
    }

    function slowDown() {
      if (rate > minRate) {
        rate -= 0.1;
        if (rate < minRate) rate = minRate;
      }
    }

    function speedUp() {
      if (rate < maxRate) {
        rate += 0.1;
        if (rate > maxRate) rate = maxRate;
      }
    }

    function checkDictation() {
      const selected = document.getElementById('dictationSelect').value;
      const original = dictations[selected].replace(/\s+/g, ' ').trim();
      const userText = document.getElementById('userInput').value.replace(/\s+/g, ' ').trim();

      const isExact = original.toLowerCase() === userText.toLowerCase();

      const result = isExact
        ? '‚úÖ Parfait ! Aucune erreur d√©tect√©e.'
        : '‚ùå Il y a des diff√©rences. Relis ta dict√©e et r√©essaie !';

      document.getElementById('result').textContent = `${result}\n\n--- Dict√©e originale ---\n${original}`;
    }

    window.speechSynthesis.onvoiceschanged = () => {
      getVoice();
    };
  </script>
</body>
</html>
