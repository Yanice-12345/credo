<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Calcul Mental Vocal</title>
  <style>
    body { font-family: Arial; text-align: center; padding: 20px; }
    button { margin: 5px; padding: 10px 15px; }
    #micro {
      width: 60px;
      height: 60px;
      margin: 10px auto;
      background: red;
      border-radius: 50%;
      animation: none;
    }
    .listening {
      animation: pulse 1s infinite;
    }
    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.2); opacity: 0.6; }
      100% { transform: scale(1); opacity: 1; }
    }
  </style>
</head>
<body>

  <h1>üß† Calcul Mental Vocal</h1>
  <p id="question">Clique sur Lire pour commencer !</p>
  
  <div>
    <button onclick="prevQuestion()">‚¨ÖÔ∏è Retour</button>
    <button onclick="repeatQuestion()">üîÅ R√©p√©ter</button>
    <button onclick="nextQuestion()">‚û°Ô∏è Passer</button>
  </div>

  <div>
    <button onclick="readQuestion()">üîä Lire</button>
    <button onclick="changeSpeed(-0.1)">üê¢ Ralentir</button>
    <button onclick="changeSpeed(0.1)">üêá Acc√©l√©rer</button>
  </div>

  <div>
    <button 
      onmousedown="startRecognition()" 
      onmouseup="stopRecognition()" 
      ontouchstart="startRecognition()" 
      ontouchend="stopRecognition()">
      üéôÔ∏è R√©pondre
    </button>
    <div id="micro"></div>
  </div>

  <script>
    const questions = [
      { q: "6 fois 2 plus 4 divis√© par 2", a: 14 },
      { q: "10 divis√© par 2 plus 3 fois 4", a: 17 },
      { q: "5 fois 3 plus 6 divis√© par 2", a: 18 },
      { q: "12 divis√© par 3 plus 4 fois 2", a: 12 },
      // Ajoutez ici les autres questions dans le m√™me format
    ];

    let current = 0;
    let speed = 1;
    let synth = window.speechSynthesis;
    let recognition;
    let listening = false;

    const questionEl = document.getElementById("question");
    const micro = document.getElementById("micro");

    function updateQuestion() {
      questionEl.textContent = `Question : ${questions[current].q}`;
    }

    function readQuestion() {
      const utterance = new SpeechSynthesisUtterance(questions[current].q);
      utterance.lang = 'fr-FR';
      utterance.rate = speed;
      synth.speak(utterance);
    }

    function changeSpeed(delta) {
      speed = Math.max(0.5, Math.min(2, speed + delta));
      alert(`Vitesse : ${speed.toFixed(1)}x`);
    }

    function nextQuestion() {
      if (current < questions.length - 1) current++;
      updateQuestion();
      readQuestion();
    }

    function prevQuestion() {
      if (current > 0) current--;
      updateQuestion();
      readQuestion();
    }

    function repeatQuestion() {
      readQuestion();
    }

    function startRecognition() {
      if (!('webkitSpeechRecognition' in window)) {
        alert("Reconnaissance vocale non support√©e.");
        return;
      }

      recognition = new webkitSpeechRecognition();
      recognition.lang = 'fr-FR';
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      recognition.onstart = () => {
        micro.classList.add('listening');
        listening = true;
      };

      recognition.onend = () => {
        micro.classList.remove('listening');
        listening = false;
      };

      recognition.onresult = event => {
        const result = event.results[0][0].transcript;
        const num = parseInt(result.match(/\d+/)); // extrait le premier nombre
        const correct = questions[current].a;

        if (num === correct) {
          speak("Bravo, c'est correct !");
        } else {
          speak(`Non, la bonne r√©ponse est ${correct}`);
        }
      };

      recognition.start();
    }

    function stopRecognition() {
      if (recognition && listening) {
        recognition.stop();
      }
    }

    function speak(text) {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = 'fr-FR';
      synth.speak(utterance);
    }

    // Init
    updateQuestion();
  </script>
</body>
</html>
